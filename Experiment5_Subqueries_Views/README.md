# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.


```sql
select salesman_id,name from salesman
where salesman_id in (select salesman_id from customer
group by salesman_id having count(salesman_id)>1);
```

**Output:**

<img width="546" height="450" alt="image" src="https://github.com/user-attachments/assets/48efab7f-6a5d-4a82-8512-63e99e20e248" />

**Question 2**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh


```sql
select * from Employee
where age < (select AVG(age) from Employee where income>250000)
```

**Output:**

<img width="1228" height="482" alt="image" src="https://github.com/user-attachments/assets/59c7947a-06d7-4844-80ea-eca1f2c732a4" />

**Question 3**
---
From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
select * from orders
where salesman_id in (select salesman_id from salesman where name='Paul Adam')
```

**Output:**

<img width="1228" height="359" alt="image" src="https://github.com/user-attachments/assets/d9110847-ed2a-4bee-9d81-733ba8960f0a" />

**Question 4**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
select * from orders 
where salesman_id in (select salesman_id from orders where customer_id=3007)
```

**Output:**

<img width="1209" height="397" alt="image" src="https://github.com/user-attachments/assets/54f8e07f-4bc9-4698-9b6e-5d5285c6fb2e" />

**Question 5**
---
From the following tables, write a SQL query to determine the commission of the salespeople in Paris. Return commission.


```sql
select commission from salesman
where salesman_id in(select salesman_id from customer where city='Paris')
```

**Output:**

<img width="314" height="302" alt="image" src="https://github.com/user-attachments/assets/7e8e0364-23e9-4486-a422-f702efc56004" />

**Question 6**
---
From the following tables write a SQL query to count the number of customers with grades above the average in New York City. Return grade and count.

```sql
select grade ,COUNT(*) 
from customer
group by grade
having grade>(select AVG(grade) from customer where city='New York')
```

**Output:**

<img width="547" height="316" alt="image" src="https://github.com/user-attachments/assets/3de40032-d455-4f24-9b50-b5395e91b01f" />

**Question 7**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
select * from orders 
where salesman_id in(select salesman_id from salesman where city='New York')
```

**Output:**

<img width="1202" height="421" alt="image" src="https://github.com/user-attachments/assets/fca2af60-4657-4031-a22b-57fcff2d4f50" />

**Question 8**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi


```sql
select * from CUSTOMERS
where address='Delhi'
```

**Output:**

<img width="1169" height="294" alt="image" src="https://github.com/user-attachments/assets/774daebf-f3f8-4e6a-9267-010aed57dcae" />

**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.


```sql
select * from CUSTOMERS
where salary>4500
```

**Output:**

<img width="1182" height="401" alt="image" src="https://github.com/user-attachments/assets/c6c5b426-d943-4daa-a8a1-994c5ac7e94b" />

**Question 10**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million


```sql
select * from Employee
where age <(select AVG(age) from Employee where income > 1000000)
```

**Output:**

<img width="1222" height="394" alt="image" src="https://github.com/user-attachments/assets/aa3480f9-8d43-49cf-8aa9-d15d7114496a" />

<img width="1920" height="1200" alt="Screenshot 2025-11-22 153030" src="https://github.com/user-attachments/assets/8e46da67-8800-4029-bf36-a3c115c0b4cc" />


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
